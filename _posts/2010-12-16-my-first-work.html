---
layout: post
title: Моя первая работа
---

<p>
Месяц назад я поддался пагубному воздействию чрезвычайно мощного
вау-импульса — на целых три недели он выбил из меня все дерьмо и я
забыл о чем я хотел писать в блог и что вообще планировал делать.
</p>
<p>
Сегодня я впервые получил деньги за написанную мной программу. 10к.
</p>
<p>
Это мало, но последний раз ради этой суммы мне пришлось целый месяц
караулить тридцать самоходных пушек в диких уголках Уссурийска — тех
местах, над которыми не властно время; там до сих пор явственно
ощущается присутствие живого и здравствующего Советского Союза. За
двадцать лет там ничего не изменилось&hellip; только обветшало и покрылось
пылью.
</p>
<p>
После того как я написал этот огромный пост про маленькую
программу-качалку на лиспе, меня неведомым образом нашел некто
@<a href="http://twitter.com/#!/pavelegorkin">pavelegorkin</a> — яблочник-игродел из местной Приморской <a href="http://kamagames.com/">Kama Games</a> и
предложил податься в Apple-аналитики — написать небольшую программку
для слежения за позициями приложений в <a href="http://www.apple.com/itunes/charts/paid-apps/">чартах iTunes Store</a>. Позже
оказалось, что там же работал давний мой теперь уже
твиттер-не-взаимофолловер @<a href="http://twitter.com/#!/sirjartur">sirjartur</a>; во-истину, мир мал. Учесть, что
мой опыт в написании реальных приложений был чуть более чем никакой —
я делать нечего, согласился; надо же когда-то начинать? Это
ознаменовало начало моего фрилансерско- <del>нищебродского</del> пути.
</p>
<p>
Решили, что писать буду на Clojure (повезло с первой работой, да и
XXI-ый век на дворе, не так ли?). Но первые несколько дней, пока
осваивал библиотеки для работы с базами данных и RSS-фидами пришлось
написать маленький прототипчик на питоне.
</p>
<p>
Через три недели я выдал результат — крохотное веб-приложеньице на 700
строк лиспокода. Зато сейчас я точно могу сказать чем отличаются
реальные программы от халоворлдов: реальные программы — это комья
грязи; липкая гадость которая склеивает энное количество технологий,
семантик и языков:
</p>
<dl>
<dt>NoSQL</dt><dd>
До этого я к базам данных вообще не прикасался и не сказать
что я их любил, скорее — опасался. Но жизнь заставила и
пришлось в экстренном порядке браться за литературу. К
SQLообразным базам у меня до сих пор недоверие, но к тому
времени я уже был наслышан о всевозможных NoSQL-базах. Три
дня осваивал CouchDB, но её возможности оказались для меня
избыточными, к тому же её авторы явно перемудрили с
MapReduce, так что я остановился на варианте по-проще:
MongoDB. Для этого я использовал библиотеку <b>congomongo</b>,
простую, удобную и в духе Clojure.

</dd>
<dt>JavaScript</dt><dd>
Для Clojure сейчас нет иного способа для выполнения
MapReduce-запросов к MongoDB, кроме как отправки куска
JavaScript-кода. Я попробовал библиотеку <b>Scriptjure</b>
для генерации джаваскрипта из S-выражений, но она
меня жутко разочаровала отсутствием формы <code>for</code>, без
которой вся эта затея просто бессмысленна.

</dd>
<dt>JSON</dt><dd>
Тут у Clojure все просто замечательно: <b>clj-json</b>
справляется с задачей перегона структур данных из/в JSON на
отлично.

</dd>
<dt>XML и HTML</dt><dd>
Java-мир несколько разочаровал меня отсутствием
вменяемого и надежного RSS-парсера на манер
питоновского <a href="http://feedparser.org">Feedparser</a>. С другой стороны я терпеть не
могу HTML-шаблоны. Для работы с XML-разметкой отныне я
использую просто охуенную парочку из
братьев-близнецов: <b>tagsoup</b> и <b>hiccup</b>.

<p>
<b>tagsoup</b> перегоняет XML в нативную для Clojure
деревянную структуру данных, состоящюю из вложенных
друг в друга векторов и хэшей. <b>hiccup</b> перегоняет эту
деревянно-векторную структуру обратно в XML и по
прямому назначению используется для генерации HTML из
нативного лиспокода.
</p>
</dd>
<dt>Время</dt><dd>
java.util.Date не так хороша как хотелось бы. <b>clj-time</b>
для временных дел куда удобнее.

</dd>
<dt>HTTP</dt><dd>
Все HTTP-клиенты для Clojure сосут. <b>clj-http</b> сосет
меньше.

</dd>
<dt>Циклы</dt><dd>
В здравом уме и твердой памяти у меня не поднимется рука
писать маломальски незатейливые циклы имеющимися в Clojure
loop'ом, doseq, for и недо-рекурсией. Я использовал
небольшой DSL для итераций <b>clj-iter</b>. Это меньшáя сестрица
библиотеки <b>iterate</b> из Common Lisp.

</dd>
<dt>Многопоточность</dt><dd>
Как ни странно, но многопоточные фичи, как-то —
60 параллельно работающих RSS-чтецов — это реально самая простая
часть программы. Спасибо, Рич Хики.

</dd>
</dl>

<p>Что я из этого вынес? Лисп вообще и Clojure в частности сейчас —
лучшее средство для интеграции всего и вся. У меня получались функции
в которых пересекались сразу три-четыре семантики и языка — HTML,
Циклы и JavaScript — и все они были S-выражениями, все они были
лиспом. И это было хорошо, потому что мне не приходилось учить вторые
языки, например, язык HTML-шаблонов.
</p>
<p>
По этому поводу Joel Moses сказал:
</p>
<blockquote>

<p>APL как красивый бриллиант — безупречный, симметричный. Но вы ничего
не можете к нему добавить. Если вы попытаетесь приклеить к нему другой
алмаз — вы не получите бóльший алмаз. Лисп же — это ком грязи. Добавь
еще и он останется комом грязи — он все еще будет выглядеть как Лисп.
</p>
</blockquote>


<p>
(Джоэль отрицает что сказал подобное, он говорит, что сравнил Лисп с
мешком фасоли, потому что он всегда возвращается к своей исходной форме)
</p>
