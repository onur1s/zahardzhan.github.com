---
layout: post
title: Emacs Starter Kit
---

<p>
Эмакс. Большая и сложная программа. Ему как ничему другому подходит
это определение. Эмакс был создан очень давно в лаборатории
искуственного интллекта MIT, он несет в себе гены очень своеобразной
культуры лисп-хакеров былых времен. С тех пор он не раз переписывался,
улучшался, дополнялся и обрастал тысячами расширений в течение
десятков лет. Эмакс, если и был когда-то мощным текстовым редактором,
сейчас стал некоей универсальной программой, в нём можно делать
абсолютно всё что угодно, если это хотя бы немного затрагивает собой
задачу отображения или редактирования текста, и даже больше. Людям
знáющим универсальность играет на руку, ведь одной программой можно
делать тысячу разных дел, при этом не прилагая усилий для переучивания
к разным интерфейсам. Людей, впервые запустивших эмакс подобная
универсальность и непривычный интерфейс поначалу пугает. Научиться
пользоваться эмаксом, понять его идею и проникнуться ею задача
непростая, трудоемкая и долгая.
</p>
<p>
Напутствие начинающим пользователям подобного рода врядли вызовет у
них энтузиазм, скорее наоборот, и тут главное начать &mdash; часто эмакс
становится чем-то вроде игрушки.
</p>
<p>
Настройка эмакса это своего рода декоративно-прикладное искусство, она
&mdash; одновременно благословение и проклятье пользователя. В отличие от
<i>vi</i>, главная прелесть которого, на мой взгляд, в том, что в нём всё
«из коробки» прекрасно настроено &mdash; бери да пользуйся, эмакс в своем
изкоробочном состоянии далеко не так хорош и удобен, как мог бы
быть. С первого же запуска начинается эпопея: эмаксер затачивает
редактор под себя, ставит расширения, заводит свои конфигурационные
файлы, подсматривает кусочки кода у других, по крупицам собирает свои
собственные настройки по всей сети &mdash; со временем накапливается
приличная база кода. И всё бы ничего, но процесс доводки до
более-менее юзабельного состояния очень долог &mdash; на это могут уйти
целые месяцы и даже годы (на самом деле настройка эмакса не
прекращается никогда).
</p>
<p>
Всё то время, что я пользовался эмаксом я именно так и поступал:
собирал конфиг по кусочкам из тысячи разных мест &mdash; форумы, <a href="http://www.linux.org.ru">ЛОР</a>,
<a href="http://habrahabr.ru">хабр</a>, <a href="http://www.emacswiki.org/">эмакс-вики</a>, статьи, репозитории с настройками продвинутых
пользователей, таких как <a href="http://alexott.net/">Alex Ott</a>, и тому подобное. В итоге конфиг
разросся до неприличных размеров и превратился в страшную кашу. В
общем, всё было плохо пока я не наткнулся на замечательный скринкаст
<a href="http://peepcode.com/products/meet-emacs">Meet Emacs</a>. В скринкасте автор не усердствует с базовой настройкой, а
сразу после установки эмакса копирует в свою директорию <code>.emacs.d</code>
репозиторий emacs-starter-kit. Сперва я скептически отнёсся к такому
подходу, но попробовав Starter Kit раз, удалив, и попробовав во второй
раз я проникся: его оказалось достаточно чтобы просто пользоваться
эмаксом, не задумываясь о его серьезных улучшениях. Всё что мне
осталось &mdash; установить через пакетный менеджер эмакса и операционной
системы необходимые мне расширения, да добавить настройки шрифтов и
клавиатуры для нетбука и настольного компьютера.
</p>
<p>
Оригинальный <a href="http://github.com/technomancy/emacs-starter-kit/">Emacs Starter Kit</a>, ныне «центральный репозиторий» оного
&mdash; это личный конфиг <a href="http://technomancy.us">Фила Хагельберга</a>, собранный им за долгие годы
использования эмакса. Сейчас Kit &mdash; это сотни форков репозитория и
тысячи следящих за ним на гитхабе.
</p>
<p>
Starter Kit рассчитан на легкую расширяемость пользовательскими
настройками и на легкую переносимость конфигурации между машинами
пользователя, так что владельцам нескольких компьютеров должно
понравиться.
</p>

<div id="outline-container-1" class="outline-3">
<h3 id="sec-1">Установка </h3>
<div class="outline-text-3" id="text-1">


<p>
Установка Emacs Starter Kit элементарна: клонируйте репозиторий с
гитхаба в директорию <code>.emacs.d</code> (предварительно сохранив свои старые
настройки и удалив <code>.emacs</code>):
</p>
<pre class="example">
git clone http://github.com/technomancy/emacs-starter-kit.git ~/.emacs.d
</pre>


<p>
Вуаля. Запускайте Emacs. (Для работы требуется GNU Emacs версии 22 или
выше. С форками вроде XEmacs работать не будет).
</p>
<p>
Чтобы запустить эмакс с kit'ом на посмотреть &mdash; склонируйте
репозиторий в какую-нибудь другую директорию и запустите эмакс
командой:
</p>
<pre class="example">
emacs -q -l ~/emacs-starter-kit/init.el
</pre>


</div>

</div>

<div id="outline-container-2" class="outline-3">
<h3 id="sec-2">Устройство </h3>
<div class="outline-text-3" id="text-2">


<p>
В директории <code>.emacs.d</code> kit'а есть несколько основных файлов:
</p>



<pre class="example">.emacs.d/
  ...
  elpa/
  init.el
  starter-kit-bindings.el
  starter-kit-defuns.el
  starter-kit-elpa.el
  ...
  ... и пользовательские
  ...
  haru.el
  haru/
    color-theme.el
    info.el
    irc.el
    jabber.el
  haru-desktop.el
  haru-netbook.el
</pre>



<p>
Самый главный файл &mdash; это <code>init.el</code>, с него начинается загрузка. Он
отключает графический интерфейс, загружает пакетный менеджер эмакса
ELPA, и, при первом запуске, доустанавливает из сети несколько
полезных пакетов (конечно, можно автоматически доустанавливать еще и
свои любимые пакеты).
</p>
<p>
Следующими подгружаются файлы <code>starter-kit-*.el</code> &mdash; в них находятся
всевозможные дополнительные функции, настройки комбинаций клавиш и
режимов для некоторых динамических языков &mdash; в общем всё то, что
делает эмакс более удобным, чем по-умолчанию.
</p>
<p>
В последнюю очередь загружаются пользовательские файлы:
</p><ul>
<li>
 Файл пользователя &mdash; файл с именем текущего пользователя с
расширением <code>.el</code> на конце, например, <code>haru.el</code>

<p>
Starter Kit настолько хорош сам по себе, что в этом файле у меня всего
лишь одна строка лиспокода, которая включает мою цветовую тему.
</p>
</li>
<li>
 Директория пользователя &mdash; директория с именем текущего
пользователя с множеством <code>.el</code> файлов внутри, например,



<pre class="example">haru/
  color-theme-dzhan.el
  info.el
  irc.el
  jabber.el
</pre>


<p>
Я держу в этой директории файлы с настройками режимов &mdash; IRC,
Jabber, Info, Org-Mode и еще самодельную цветовую тему.
</p>
</li>
<li>
 Файл с настройками машины пользователя &mdash; чтобы узнать имя этого
файла достаточно вычислить в эмаксе значение функции <code>(system-name)</code>
и добавить <code>.el</code> в конец, например: <code>haru-netbook.el</code> для
нетбука и <code>haru-desktop.el</code> для десктопа.

<p>
Я держу в нём настройки дефолтного шрифта и настройку кнопок <b>Alt</b> и
<b>Command</b> для яблочной клавиатуры.
</p></li>
</ul>


</div>

</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">Фичи </h2>
<div class="outline-text-2" id="text-1">



</div>

<div id="outline-container-1_1" class="outline-3">
<h3 id="sec-1_1">Emacs Lisp Package Archive </h3>
<div class="outline-text-3" id="text-1_1">


<p>
Пакетный менеджер для эмакса. Уже сейчас в больше сотни популярных
расширений, автоматически поддерживает зависимости между
ними. Элементарен в использовании: <b>M-x package-list-packages</b>, <b>i</b>
&mdash; отметить для установки, <b>x</b> &mdash; установить. Пакеты устанавливаются
в директорию <code>~/.emacs.d/elpa</code>.
</p>
<p>
Для автоматической установки нужных пакетов при первом запуске эмакса
нужно отредактировать переменную <code>starter-kit-packages</code> в файле
<code>starter-kit-elpa.el</code>. Мне, например никак без <a href="http://clojure.org">Clojure</a>, и я активно
пользуюсь сервисом <a href="http://gist.github.com/">gist.github.com</a>:
</p>



<pre class="src src-emacs-lisp"><span style="color: #8c8c8c;">(</span><span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">starter-kit-packages</span> 
  <span style="color: #8c8c8c;">(</span>list 'clojure-mode
        'clojure-test-mode
        'css-mode
        'gist
        'inf-ruby
        'magit
        'ruby-mode
        'slime 
        'slime-repl
        'swank-clojure
        'yaml-mode
        'idle-highlight<span style="color: #8c8c8c;">))</span>
</pre>



<p>
Starter Kit развивается уже очень давно и из <code>elpa-to-submit/</code>,
бывает, удаляют код некоторых пакетов, но это ничего &mdash; удаленный код
перетекает в ELPA. Если с очередным обновлением (я имею в виду
pull/merge с «центральным» репозиторием) возникают проблемы &mdash; удалите
всё из директории <code>~/.emacs.d/elpa</code> и запустите <b>M-x starter-kit-elpa-install</b>.
</p>
</div>

</div>

<div id="outline-container-1_2" class="outline-3">
<h3 id="sec-1_2">IDO </h3>
<div class="outline-text-3" id="text-1_2">


<p>
Режим ido (интеллектуальная подсказка, похоже на intelli-sence из
продукции Microsoft) везде где нужно &mdash; при переключении буферов,
открытии, сохранении файлов и прочем. В он очень облегчает выбор
вариантов и ускоряет работу в минибуфере.
</p>
<p>
Еще одна жутко удобная фича &mdash; imenu, позволяет прыгнуть к определению
символа в исходнике, вызывается по <b>C-x C-i</b> или <b>C-x TAB</b>.
</p>
</div>

</div>

<div id="outline-container-1_3" class="outline-3">
<h3 id="sec-1_3">IBuffer </h3>
<div class="outline-text-3" id="text-1_3">


<p>
Более функциональная замена стандартной переключалке буферов.
</p>
</div>

</div>

<div id="outline-container-1_4" class="outline-3">
<h3 id="sec-1_4">Полоска сбоку </h3>
<div class="outline-text-3" id="text-1_4">


<p>
Полоска сбоку, показывающая конец буфера. Очень удобная.
</p>
</div>

</div>

<div id="outline-container-1_5" class="outline-3">
<h3 id="sec-1_5">Редактирование под sudo </h3>
<div class="outline-text-3" id="text-1_5">


<p>
Раньше для редактирования системных файлов мне приходилось специально
запускать vi под sudo. В Kit'е есть функция <b>M-x sudo-edit</b>.
</p>
</div>

</div>

<div id="outline-container-1_6" class="outline-3">
<h3 id="sec-1_6">Lambda </h3>
<div class="outline-text-3" id="text-1_6">


<p>
Лямбды в лиспокоде отображаются греческими буквами. В исходниках
Clojure fn заменяется на ƒ.
</p>
</div>

</div>

<div id="outline-container-1_7" class="outline-3">
<h3 id="sec-1_7">Улучшения в режимах динмамических языков </h3>
<div class="outline-text-3" id="text-1_7">


<p>
Множество всевозможных удобств для пользователей динамических языков:
JavaScript, Emacs Lisp, Clojure, Common Lisp, Ruby, Perl. Сам-то в
основном лиспами пользуюсь, поэтому улучшения в режимах лиспа и
приведу.
</p>
<p>
В первую очередь это, конечно, paredit-mode &mdash; режим структурного
редактирования лиспокода. Проще говоря, он расставляет, переставляет и
удаляет скобочки с учётом семантики кода. Возможно, сразу его освоить
не получиться, потому что этот режим выполнен в лучших традициях
эмакса с добрым десятком зубодробительных комбинаций, но после
длительного использования и привыкания без него будет уже непросто.
</p>
<p>
Показываются аргументы функций Emacs Lisp'а в минибуфере.
</p>
</div>

</div>

<div id="outline-container-1_8" class="outline-3">
<h3 id="sec-1_8">Отключенный графический интерфейс </h3>
<div class="outline-text-3" id="text-1_8">


<p>
Нет скроллбара, нет тулбара, нет меню, нет диалоговых окон. Всего
этого нет, ибо принесено в жертву экономии движения. Графические
элементы управления требуют мышь, а чтобы дотянуться до мыши нужно
оторвать руку от клавиатуры, в случае меню еще потратить уйму времени
на поиск нужного пункта. От того, что эти элементы управления
отключены &mdash; от пользователя не убудет &mdash; функционал отключеных
элементов продублирован в интерфейсе. Во время редактирования если и
используются меню, то это меню текущих режимов, а они доступны в
полоске modeline. Скроллбар прекрасно заменяется стандартными
клавишами для перемещения по буферу и колёсиком мыши. Тулбар же просто
не нужен &mdash; выполнить любое действие проще через кейбиндинг.
</p>
</div>

</div>

<div id="outline-container-1_9" class="outline-3">
<h3 id="sec-1_9">Комбинации клавиш </h3>
<div class="outline-text-3" id="text-1_9">


<p>
Честно говоря, комбинации клавиш в Emacs Starter Kit мне не очень
нравятся, тем более, что они не сильно отличаются от стандартных. Так
что я приведу некоторые свои комбинации (которые можно найти в файле
<code>starter-kit-bindings.el</code> в <a href="http://github.com/zahardzhan/emacs-starter-kit">моём форке kit'а на гитхабе</a>.
</p>
<p>
Сперва, однако, стоит вспомнить о том, что Emacs &mdash; древнейшая ныне
здравствующая и широко используемая софтина, и оригинальные сочетания
клавиш рассчитаны вовсе не на современные PC/Apple/&hellip; клавиатуры, а
на клавиатуры почивших 20 лет назад лисп-машин (например, в мануале по
Zmacs для Ti Explorer 1985 года можно найти те же самые комбинации,
что используются сейчас). Вспомнить и принять меры, иначе незадачливый
эмаксер рискует стать жертвой «синдрома эмаксового мизинца» &mdash; из-за
активного использования клавиши <b>Control</b>, которую на современных
клавиатурах жуть как неудобно нажимать несколько сотен раз в час. Есть
много способов сохранить здоровье своих рук:
</p>
<ul>
<li>
Самый простой: поменять <b>Caps Lock</b> и <b>Control</b>. Если вы не
счастливый обладатель Happy Hacking Keyboard &mdash; меняйте, даже не
думайте. Я пользуюсь Ubuntu &mdash; в ней поменять не проблема &mdash; ищите
опцию в параметрах системы.

</li>
<li>
Купить нормальную клавиатуру. Из нормальных мне известные, разве что
эргономичная микрософтовская клава и клавиатуры Kinesis.

</li>
<li>
Поменять кейбиндинги в эмаксе. Ибо большинство дефолтных &mdash; не
фонтан. Но особо усердствовать не стоит &mdash; сочетания эмакса
используются во многих местах, в первую очередь в bash и zsh.

</li>
</ul>

<p>Расскажу о некоторых своих комбинациях:
</p><dl>
<dt>C-m</dt><dd>
Альтернатива клавише <b>Enter</b>. Комбинация особенна полезна как
окончание в цепочке, в которой все клавиши нажимаются вместе
с <b>Control</b>'ом &mdash; чтобы не отпускать его и тянуться к <b>Enter</b>,
например я переключаюсь между буферами даже не отжимая
<b>Control</b>: <b>C-Tab C-s C-s C-s C-m</b>.

<p>
Еще это комбинация полезна как замена <b>M-x</b>: <b>C-x C-m</b>, если
до альта долго тянуться.
</p>
</dd>
<dt>C-w</dt><dd>
Практически во всех эмуляторах терминалов эта клавиша удаляет
слово слева от курсора, в эмаксе же она не делает ничего
хорошего. Я забиндил на неё удаление слова назад и вырезание
региона, если он выделен &mdash; это очень удобно, <b>Backspace</b>
практически не нужен. Ко всему, <b>M-w</b> копирует выделенный
регион.

</dd>
<dt>C-g</dt><dd>
Забудьте об <b>Esc</b>. Если что-то пошло не так &mdash; это клавиша
универсальной отмены.

</dd>
<dt>C-q</dt><dd>
Замена <b>C-/</b>. Отмена редактирования. Таким образом ряд
сочетаний, который в стандартных оконных системах расположен
внизу &mdash; <b>C-z, C-x, C-c</b> у меня переезжает наверх &mdash; <b>C-q,          C-w, M-w</b>. (Если кто подскажет как совместить эту клавишу с
<b>C-g</b> &mdash; буду очень благодарен).

</dd>
<dt>C-Tab</dt><dd>
Обычно я держу очень много буферов и часто между ними
переключаюсь. Нажимать для этого <i>двумя руками</i> <b>C-x b</b> —
невероятная расточительность.

</dd>
<dt>S-Tab, C-S-Tab</dt><dd>
Переход на следующее/предыдущее окно. Быстро и удобно. Таким
образом, три клавиши, расположенные вплотную одна-над-другой
используются для переключения между буферами.

</dd>
<dt>C-x C-k</dt><dd>
Убивать буфер гораздо легче не отпуская клавишу
<b>Control</b> &mdash; так можно в <i>разы</i> быстрее убить сразу несколько
буферов.

</dd>
<dt>C-s, C-r</dt><dd>
Эти клавиши привязаны к поиску по регэкспу вперёд и
назад. Помнится, один из авторов Макинтоша, Джеф Раскин,
положил подобный поиск в основу интерфейса компьютера для
работы с текстом Cannon Cat. Это конечно, не Cannon Cat, но
тоже ничего.

<p>
Эти клавиши используются не только для поиска в буфере, но и
для перехода к следующему или предыдущему элементу в минибуфере в
режиме ido &mdash; для переключения между буферами или для поиска и
открытия файла. И еще в режиме выделения региона.
</p>
</dd>
<dt>S-Space</dt><dd>
Очень умное автодополнение. Иногда достаточно просто раз
пять нажать эту комбинацию и программа чудесным образом
напишется сама.

</dd>
<dt>M-Space</dt><dd>
Переключение между языками. Две легко доступные, вплотную
расположенные клавиши &mdash; это лучший вариант.

</dd>
<dt>F3, F4, F4</dt><dd>
Начало записи макроса, конец записи макроса, вызов
макроса.
</dd>
</dl>

</div>
</div>
</div>
